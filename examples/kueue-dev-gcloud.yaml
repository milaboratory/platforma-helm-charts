# Example values for kueue-setup chart on GKE dev environment
#
# Usage:
#   helm install kueue ./charts/kueue-setup \
#     --namespace dev-gke \
#     --values examples/kueue-dev-gcloud.yaml

queues:
  enabled: true
  resourceFlavor:
    name: "default"
  clusterQueue:
    name: "platforma-cluster-queue"
    resources:
      cpu: "32"
      memory: "64Gi"
  localQueue:
    name: "platforma-local-queue"

kueue-controller:
  enableVisibilityAPF: false
  managerConfig:
    controllerManagerConfigYaml: |
      apiVersion: config.kueue.x-k8s.io/v1beta1
      kind: Configuration
      namespace: dev-gke
      health:
        healthProbeBindAddress: :8081
      metrics:
        bindAddress: :8443
      webhook:
        port: 9443
      leaderElection:
        leaderElect: true
        resourceName: c1f6bfd2.kueue.x-k8s.io
      controller:
        groupKindConcurrency:
          Job.batch: 5
          Pod: 5
          Workload.kueue.x-k8s.io: 5
          LocalQueue.kueue.x-k8s.io: 1
          ClusterQueue.kueue.x-k8s.io: 1
          ResourceFlavor.kueue.x-k8s.io: 1
      clientConnection:
        qps: 50
        burst: 100
      # IMPORTANT: These names must match the Helm release name
      # If release name is "kueue", use:
      #   kueue-kueue-controller-webhook-service
      #   kueue-kueue-controller-webhook-server-cert
      internalCertManagement:
        enable: true
        webhookServiceName: kueue-kueue-controller-webhook-service
        webhookSecretName: kueue-kueue-controller-webhook-server-cert
      integrations:
        frameworks:
        - "batch/job"
      # WaitForPodsReady - all-or-nothing scheduling
      # Set timeout based on your cluster's autoscaling speed
      waitForPodsReady:
        enable: true
        timeout: 10s                  # Short timeout for testing
        recoveryTimeout: 3m
        blockAdmission: false
        requeuingStrategy:
          timestamp: Eviction
          backoffLimitCount: 0        # 0 = fail immediately, no retries
          backoffBaseSeconds: 60
          backoffMaxSeconds: 3600
      # Garbage collection - clean up finished workloads
      objectRetentionPolicies:
        workloads:
          afterFinished: "1h"
          afterDeactivatedByKueue: "30m"

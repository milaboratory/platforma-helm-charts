# =============================================================================
# Kueue Setup Helm Chart Configuration
# =============================================================================
# This chart installs and configures Kueue for Kubernetes job queue management.
# It includes the Kueue controller and creates queue resources.

# -- Kueue controller configuration
controller:
  # -- Enable the Kueue controller subchart
  enabled: true

# -- Queue resources configuration
queues:
  # -- Enable creation of queue resources (ResourceFlavor, ClusterQueue, LocalQueue)
  enabled: true

  # -- ResourceFlavor defines the types of resources available in the cluster.
  resourceFlavor:
    name: "default"
    # -- Node labels to match this flavor (optional)
    # nodeLabels:
    #   node.kubernetes.io/instance-type: "n1-standard-4"
    # -- Tolerations to add to workloads using this flavor (optional)
    # tolerations: []

  # -- ClusterQueue defines the resource quotas available for the cluster.
  clusterQueue:
    name: "cluster-queue"
    # -- Namespace selector - empty means all namespaces
    namespaceSelector: {}
    # -- Resource quotas for the cluster queue
    resources:
      cpu: "32"
      memory: "64Gi"
    # -- Additional resource groups (e.g., GPU)
    # additionalResourceGroups: []

  # -- LocalQueue is a namespaced queue that points to a ClusterQueue.
  localQueue:
    name: "local-queue"

# -- Kueue controller subchart configuration (alias: kueue-controller)
# Override these values to customize the Kueue controller.
# See: https://kueue.sigs.k8s.io/docs/installation/
kueue-controller:
  # -- Disable visibility API by default (requires additional RBAC setup)
  enableVisibilityAPF: false

  # -- Manager configuration
  # IMPORTANT: Replace <RELEASE_NAME> and <NAMESPACE> with your actual values,
  # or use the --set flag during helm install/upgrade.
  #
  # Example:
  #   helm install kueue ./kueue-setup \
  #     --namespace kueue-system \
  #     --set kueue-controller.managerConfig.controllerManagerConfigYaml="..."
  #
  # managerConfig:
  #   controllerManagerConfigYaml: |
  #     apiVersion: config.kueue.x-k8s.io/v1beta1
  #     kind: Configuration
  #     namespace: kueue-system
  #     health:
  #       healthProbeBindAddress: :8081
  #     metrics:
  #       bindAddress: :8443
  #     webhook:
  #       port: 9443
  #     leaderElection:
  #       leaderElect: true
  #       resourceName: c1f6bfd2.kueue.x-k8s.io
  #     controller:
  #       groupKindConcurrency:
  #         Job.batch: 5
  #         Pod: 5
  #         Workload.kueue.x-k8s.io: 5
  #         LocalQueue.kueue.x-k8s.io: 1
  #         ClusterQueue.kueue.x-k8s.io: 1
  #         ResourceFlavor.kueue.x-k8s.io: 1
  #     clientConnection:
  #       qps: 50
  #       burst: 100
  #     internalCertManagement:
  #       enable: true
  #       webhookServiceName: <RELEASE_NAME>-kueue-controller-webhook-service
  #       webhookSecretName: <RELEASE_NAME>-kueue-controller-webhook-server-cert
  #     integrations:
  #       frameworks:
  #       - "batch/job"
  #     # WaitForPodsReady - all-or-nothing scheduling
  #     waitForPodsReady:
  #       enable: true
  #       timeout: 5m
  #       recoveryTimeout: 3m
  #       blockAdmission: false
  #       requeuingStrategy:
  #         timestamp: Eviction
  #         backoffLimitCount: 5
  #         backoffBaseSeconds: 60
  #         backoffMaxSeconds: 3600
  #     # Garbage collection of finished workloads
  #     objectRetentionPolicies:
  #       workloads:
  #         afterFinished: "1h"
  #         afterDeactivatedByKueue: "30m"

# -- CA Patcher configuration
# The CA patcher is a post-install hook that patches webhook configurations
# with the CA bundle from the Kueue controller's certificate secret.
caPatcher:
  # -- Enable the CA patcher job
  enabled: true
  # -- Image for the CA patcher
  image:
    repository: bitnami/kubectl
    tag: latest
    pullPolicy: IfNotPresent
  # -- Timeout in seconds to wait for the certificate secret
  timeout: 300
